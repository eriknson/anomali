"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _reactMapGlDraw = require("react-map-gl-draw");

var _window = _interopRequireDefault(require("global/window"));

var _classnames = _interopRequireDefault(require("classnames"));

var _lodash = _interopRequireDefault(require("lodash.get"));

var _defaultSettings = require("../../constants/default-settings");

var _featureActionPanel = _interopRequireDefault(require("./feature-action-panel"));

var _featureStyles = require("./feature-styles");

var _handleStyle = require("./handle-style");

var _constants = require("../../constants");

var _reselect = require("reselect");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _templateObject() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  cursor: ", ";\n  position: relative;\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

var DELETE_KEY_EVENT_CODE = 46;
var BACKSPACE_KEY_EVENT_CODE = 8;
var ESCAPE_KEY_EVENT_CODE = 27;

var StyledWrapper = _styledComponents["default"].div(_templateObject(), function (props) {
  return props.editor.mode === _constants.EDITOR_MODES.EDIT ? 'pointer' : 'crosshair';
});

var editorLayerFilter = function editorLayerFilter(layer) {
  return _defaultSettings.EDITOR_AVAILABLE_LAYERS.includes(layer.type);
};

var Editor =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Editor, _Component);

  function Editor() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, Editor);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(Editor)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
      showActions: false,
      lastPosition: null
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "layerSelector", function (props) {
      return props.layers;
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "layersToRenderSelector", function (props) {
      return props.layersToRender;
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "filterSelector", function (props) {
      return props.filters;
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "selectedFeatureIdSelector", function (props) {
      return (0, _lodash["default"])(props, ['editor', 'selectedFeature', 'id']);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "editorFeatureSelector", function (props) {
      return (0, _lodash["default"])(props, ['editor', 'features']);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "currentFilterSelector", (0, _reselect.createSelector)(_this.filterSelector, _this.selectedFeatureIdSelector, function (filters, selectedFeatureId) {
      return filters.find(function (f) {
        return f.value && f.value.id === selectedFeatureId;
      });
    }));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "availableLayersSeletor", (0, _reselect.createSelector)(_this.layerSelector, _this.layersToRenderSelector, function (layers, layersToRender) {
      return layers.filter(editorLayerFilter).filter(function (layer) {
        return layersToRender[layer.id];
      });
    }));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "allFeaturesSelector", (0, _reselect.createSelector)(_this.filterSelector, _this.editorFeatureSelector, function (filters, editorFeatures) {
      return filters.filter(function (f) {
        return f.type === _defaultSettings.FILTER_TYPES.polygon;
      }).map(function (f) {
        return f.value;
      }).concat(editorFeatures);
    }));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_onKeyPressed", function (event) {
      var isEnabled = _this.props.isEnabled;

      if (!isEnabled) {
        return;
      }

      switch (event.which) {
        case DELETE_KEY_EVENT_CODE:
        case BACKSPACE_KEY_EVENT_CODE:
          _this._onDeleteSelectedFeature();

          break;

        case ESCAPE_KEY_EVENT_CODE:
          _this.props.onSelect(null);

          break;

        default:
          break;
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_onSelect", function (_ref) {
      var selectedFeatureId = _ref.selectedFeatureId,
          sourceEvent = _ref.sourceEvent;

      var allFeatures = _this.allFeaturesSelector(_this.props);

      _this.setState(_objectSpread({}, sourceEvent.rightButton ? {
        showActions: true,
        lastPosition: {
          x: sourceEvent.changedPointers[0].offsetX,
          y: sourceEvent.changedPointers[0].offsetY
        }
      } : null), function () {
        _this.props.onSelect(allFeatures.find(function (f) {
          return f.id === selectedFeatureId;
        }));
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_onDeleteSelectedFeature", function () {
      if (_this.state.showActions) {
        _this.setState({
          showActions: false
        });
      }

      var editor = _this.props.editor;
      var _editor$selectedFeatu = editor.selectedFeature,
          selectedFeature = _editor$selectedFeatu === void 0 ? {} : _editor$selectedFeatu;

      _this.props.onDeleteFeature(selectedFeature);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_closeFeatureAction", function () {
      _this.setState({
        showActions: false
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_onToggleLayer", function (layer) {
      var selectedFeature = _this.props.editor.selectedFeature;

      if (!selectedFeature) {
        return;
      }

      _this.props.onTogglePolygonFilter(layer, selectedFeature);
    });
    return _this;
  }

  (0, _createClass2["default"])(Editor, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      _window["default"].addEventListener('keydown', this._onKeyPressed);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      _window["default"].removeEventListener('keydown', this._onKeyPressed);
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          className = _this$props.className,
          clickRadius = _this$props.clickRadius,
          datasets = _this$props.datasets,
          editor = _this$props.editor,
          onUpdate = _this$props.onUpdate,
          style = _this$props.style;
      var _this$state = this.state,
          lastPosition = _this$state.lastPosition,
          showActions = _this$state.showActions;
      var selectedFeatureId = (0, _lodash["default"])(editor, ['selectedFeature', 'id']);
      var currentFilter = this.currentFilterSelector(this.props);
      var availableLayers = this.availableLayersSeletor(this.props);
      var allFeatures = this.allFeaturesSelector(this.props);
      return _react["default"].createElement(StyledWrapper, {
        editor: editor,
        className: (0, _classnames["default"])('editor', className),
        style: style
      }, _react["default"].createElement(_reactMapGlDraw.Editor, {
        clickRadius: clickRadius,
        mode: editor.mode,
        features: allFeatures,
        selectedFeatureId: selectedFeatureId,
        onSelect: this._onSelect,
        onUpdate: onUpdate,
        getEditHandleShape: _handleStyle.getEditHandleShape,
        getFeatureStyle: _featureStyles.getStyle,
        getEditHandleStyle: _handleStyle.getStyle
      }), showActions && Boolean(selectedFeatureId) ? _react["default"].createElement(_featureActionPanel["default"], {
        datasets: datasets,
        layers: availableLayers,
        currentFilter: currentFilter,
        onClose: this._closeFeatureAction,
        onDeleteFeature: this._onDeleteSelectedFeature,
        onToggleLayer: this._onToggleLayer,
        position: lastPosition
      }) : null);
    }
  }]);
  return Editor;
}(_react.Component);

(0, _defineProperty2["default"])(Editor, "propTypes", {
  filters: _propTypes["default"].arrayOf(_propTypes["default"].object).isRequired,
  layers: _propTypes["default"].arrayOf(_propTypes["default"].object).isRequired,
  datasets: _propTypes["default"].object.isRequired,
  editor: _propTypes["default"].object.isRequired,
  layersToRender: _propTypes["default"].object.isRequired,
  onSelect: _propTypes["default"].func.isRequired,
  onUpdate: _propTypes["default"].func.isRequired,
  onDeleteFeature: _propTypes["default"].func.isRequired,
  onTogglePolygonFilter: _propTypes["default"].func.isRequired,
  index: _propTypes["default"].number,
  classnames: _propTypes["default"].string,
  clickRadius: _propTypes["default"].number,
  isEnabled: _propTypes["default"].bool
});
(0, _defineProperty2["default"])(Editor, "defaultProps", {
  clickRadius: _featureStyles.DEFAULT_RADIUS
});
var _default = Editor;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2VkaXRvci9lZGl0b3IuanMiXSwibmFtZXMiOlsiREVMRVRFX0tFWV9FVkVOVF9DT0RFIiwiQkFDS1NQQUNFX0tFWV9FVkVOVF9DT0RFIiwiRVNDQVBFX0tFWV9FVkVOVF9DT0RFIiwiU3R5bGVkV3JhcHBlciIsInN0eWxlZCIsImRpdiIsInByb3BzIiwiZWRpdG9yIiwibW9kZSIsIkVESVRPUl9NT0RFUyIsIkVESVQiLCJlZGl0b3JMYXllckZpbHRlciIsImxheWVyIiwiRURJVE9SX0FWQUlMQUJMRV9MQVlFUlMiLCJpbmNsdWRlcyIsInR5cGUiLCJFZGl0b3IiLCJzaG93QWN0aW9ucyIsImxhc3RQb3NpdGlvbiIsImxheWVycyIsImxheWVyc1RvUmVuZGVyIiwiZmlsdGVycyIsImZpbHRlclNlbGVjdG9yIiwic2VsZWN0ZWRGZWF0dXJlSWRTZWxlY3RvciIsInNlbGVjdGVkRmVhdHVyZUlkIiwiZmluZCIsImYiLCJ2YWx1ZSIsImlkIiwibGF5ZXJTZWxlY3RvciIsImxheWVyc1RvUmVuZGVyU2VsZWN0b3IiLCJmaWx0ZXIiLCJlZGl0b3JGZWF0dXJlU2VsZWN0b3IiLCJlZGl0b3JGZWF0dXJlcyIsIkZJTFRFUl9UWVBFUyIsInBvbHlnb24iLCJtYXAiLCJjb25jYXQiLCJldmVudCIsImlzRW5hYmxlZCIsIndoaWNoIiwiX29uRGVsZXRlU2VsZWN0ZWRGZWF0dXJlIiwib25TZWxlY3QiLCJzb3VyY2VFdmVudCIsImFsbEZlYXR1cmVzIiwiYWxsRmVhdHVyZXNTZWxlY3RvciIsInNldFN0YXRlIiwicmlnaHRCdXR0b24iLCJ4IiwiY2hhbmdlZFBvaW50ZXJzIiwib2Zmc2V0WCIsInkiLCJvZmZzZXRZIiwic3RhdGUiLCJzZWxlY3RlZEZlYXR1cmUiLCJvbkRlbGV0ZUZlYXR1cmUiLCJvblRvZ2dsZVBvbHlnb25GaWx0ZXIiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiX29uS2V5UHJlc3NlZCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjbGFzc05hbWUiLCJjbGlja1JhZGl1cyIsImRhdGFzZXRzIiwib25VcGRhdGUiLCJzdHlsZSIsImN1cnJlbnRGaWx0ZXIiLCJjdXJyZW50RmlsdGVyU2VsZWN0b3IiLCJhdmFpbGFibGVMYXllcnMiLCJhdmFpbGFibGVMYXllcnNTZWxldG9yIiwiX29uU2VsZWN0IiwiZ2V0RWRpdEhhbmRsZVNoYXBlIiwiZ2V0RmVhdHVyZVN0eWxlIiwiZ2V0RWRpdEhhbmRsZVN0eWxlIiwiQm9vbGVhbiIsIl9jbG9zZUZlYXR1cmVBY3Rpb24iLCJfb25Ub2dnbGVMYXllciIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsImFycmF5T2YiLCJvYmplY3QiLCJpc1JlcXVpcmVkIiwiZnVuYyIsImluZGV4IiwibnVtYmVyIiwiY2xhc3NuYW1lcyIsInN0cmluZyIsImJvb2wiLCJERUZBVUxUX1JBRElVUyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUdBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEscUJBQXFCLEdBQUcsRUFBOUI7QUFDQSxJQUFNQyx3QkFBd0IsR0FBRyxDQUFqQztBQUNBLElBQU1DLHFCQUFxQixHQUFHLEVBQTlCOztBQUVBLElBQU1DLGFBQWEsR0FBR0MsNkJBQU9DLEdBQVYsb0JBQ1AsVUFBQUMsS0FBSztBQUFBLFNBQUtBLEtBQUssQ0FBQ0MsTUFBTixDQUFhQyxJQUFiLEtBQXNCQyx3QkFBYUMsSUFBbkMsR0FBMEMsU0FBMUMsR0FBc0QsV0FBM0Q7QUFBQSxDQURFLENBQW5COztBQUtBLElBQU1DLGlCQUFpQixHQUFHLFNBQXBCQSxpQkFBb0IsQ0FBQUMsS0FBSztBQUFBLFNBQUlDLHlDQUF3QkMsUUFBeEIsQ0FBaUNGLEtBQUssQ0FBQ0csSUFBdkMsQ0FBSjtBQUFBLENBQS9COztJQUVNQyxNOzs7Ozs7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Yk47QUFjakI3QyxFQUFBQSxTQUFTLEVBQUV1QyxzQkFBVVM7QUFkSixDO2lDQURmdkUsTSxrQkFrQmtCO0FBQ3BCOEMsRUFBQUEsV0FBVyxFQUFFMEI7QUFETyxDO2VBcUpUeEUsTSIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAyMCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbmltcG9ydCBSZWFjdCwge0NvbXBvbmVudH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtFZGl0b3IgYXMgRHJhd30gZnJvbSAncmVhY3QtbWFwLWdsLWRyYXcnO1xuaW1wb3J0IHdpbmRvdyBmcm9tICdnbG9iYWwvd2luZG93JztcbmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IGdldCBmcm9tICdsb2Rhc2guZ2V0JztcblxuaW1wb3J0IHtFRElUT1JfQVZBSUxBQkxFX0xBWUVSU30gZnJvbSAnY29uc3RhbnRzL2RlZmF1bHQtc2V0dGluZ3MnO1xuaW1wb3J0IEZlYXR1cmVBY3Rpb25QYW5lbCBmcm9tICcuL2ZlYXR1cmUtYWN0aW9uLXBhbmVsJztcbmltcG9ydCB7RklMVEVSX1RZUEVTfSBmcm9tICdjb25zdGFudHMvZGVmYXVsdC1zZXR0aW5ncyc7XG5cbmltcG9ydCB7REVGQVVMVF9SQURJVVMsIGdldFN0eWxlIGFzIGdldEZlYXR1cmVTdHlsZX0gZnJvbSAnLi9mZWF0dXJlLXN0eWxlcyc7XG5pbXBvcnQge2dldFN0eWxlIGFzIGdldEVkaXRIYW5kbGVTdHlsZSwgZ2V0RWRpdEhhbmRsZVNoYXBlfSBmcm9tICcuL2hhbmRsZS1zdHlsZSc7XG5pbXBvcnQge0VESVRPUl9NT0RFU30gZnJvbSAnY29uc3RhbnRzJztcbmltcG9ydCB7Y3JlYXRlU2VsZWN0b3J9IGZyb20gJ3Jlc2VsZWN0JztcblxuY29uc3QgREVMRVRFX0tFWV9FVkVOVF9DT0RFID0gNDY7XG5jb25zdCBCQUNLU1BBQ0VfS0VZX0VWRU5UX0NPREUgPSA4O1xuY29uc3QgRVNDQVBFX0tFWV9FVkVOVF9DT0RFID0gMjc7XG5cbmNvbnN0IFN0eWxlZFdyYXBwZXIgPSBzdHlsZWQuZGl2YFxuICBjdXJzb3I6ICR7cHJvcHMgPT4gKHByb3BzLmVkaXRvci5tb2RlID09PSBFRElUT1JfTU9ERVMuRURJVCA/ICdwb2ludGVyJyA6ICdjcm9zc2hhaXInKX07XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbmA7XG5cbmNvbnN0IGVkaXRvckxheWVyRmlsdGVyID0gbGF5ZXIgPT4gRURJVE9SX0FWQUlMQUJMRV9MQVlFUlMuaW5jbHVkZXMobGF5ZXIudHlwZSk7XG5cbmNsYXNzIEVkaXRvciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZmlsdGVyczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLm9iamVjdCkuaXNSZXF1aXJlZCxcbiAgICBsYXllcnM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5vYmplY3QpLmlzUmVxdWlyZWQsXG4gICAgZGF0YXNldHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBlZGl0b3I6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBsYXllcnNUb1JlbmRlcjogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIG9uU2VsZWN0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uVXBkYXRlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uRGVsZXRlRmVhdHVyZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBvblRvZ2dsZVBvbHlnb25GaWx0ZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG5cbiAgICBpbmRleDogUHJvcFR5cGVzLm51bWJlcixcbiAgICBjbGFzc25hbWVzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNsaWNrUmFkaXVzOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGlzRW5hYmxlZDogUHJvcFR5cGVzLmJvb2xcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGNsaWNrUmFkaXVzOiBERUZBVUxUX1JBRElVU1xuICB9O1xuXG4gIHN0YXRlID0ge1xuICAgIHNob3dBY3Rpb25zOiBmYWxzZSxcbiAgICBsYXN0UG9zaXRpb246IG51bGxcbiAgfTtcblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX29uS2V5UHJlc3NlZCk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX29uS2V5UHJlc3NlZCk7XG4gIH1cblxuICBsYXllclNlbGVjdG9yID0gcHJvcHMgPT4gcHJvcHMubGF5ZXJzO1xuICBsYXllcnNUb1JlbmRlclNlbGVjdG9yID0gcHJvcHMgPT4gcHJvcHMubGF5ZXJzVG9SZW5kZXI7XG4gIGZpbHRlclNlbGVjdG9yID0gcHJvcHMgPT4gcHJvcHMuZmlsdGVycztcbiAgc2VsZWN0ZWRGZWF0dXJlSWRTZWxlY3RvciA9IHByb3BzID0+IGdldChwcm9wcywgWydlZGl0b3InLCAnc2VsZWN0ZWRGZWF0dXJlJywgJ2lkJ10pO1xuICBlZGl0b3JGZWF0dXJlU2VsZWN0b3IgPSBwcm9wcyA9PiBnZXQocHJvcHMsIFsnZWRpdG9yJywgJ2ZlYXR1cmVzJ10pO1xuXG4gIGN1cnJlbnRGaWx0ZXJTZWxlY3RvciA9IGNyZWF0ZVNlbGVjdG9yKFxuICAgIHRoaXMuZmlsdGVyU2VsZWN0b3IsXG4gICAgdGhpcy5zZWxlY3RlZEZlYXR1cmVJZFNlbGVjdG9yLFxuICAgIChmaWx0ZXJzLCBzZWxlY3RlZEZlYXR1cmVJZCkgPT4gZmlsdGVycy5maW5kKGYgPT4gZi52YWx1ZSAmJiBmLnZhbHVlLmlkID09PSBzZWxlY3RlZEZlYXR1cmVJZClcbiAgKTtcblxuICBhdmFpbGFibGVMYXllcnNTZWxldG9yID0gY3JlYXRlU2VsZWN0b3IoXG4gICAgdGhpcy5sYXllclNlbGVjdG9yLFxuICAgIHRoaXMubGF5ZXJzVG9SZW5kZXJTZWxlY3RvcixcbiAgICAobGF5ZXJzLCBsYXllcnNUb1JlbmRlcikgPT5cbiAgICAgIGxheWVycy5maWx0ZXIoZWRpdG9yTGF5ZXJGaWx0ZXIpLmZpbHRlcihsYXllciA9PiB7XG4gICAgICAgIHJldHVybiBsYXllcnNUb1JlbmRlcltsYXllci5pZF07XG4gICAgICB9KVxuICApO1xuXG4gIGFsbEZlYXR1cmVzU2VsZWN0b3IgPSBjcmVhdGVTZWxlY3RvcihcbiAgICB0aGlzLmZpbHRlclNlbGVjdG9yLFxuICAgIHRoaXMuZWRpdG9yRmVhdHVyZVNlbGVjdG9yLFxuICAgIChmaWx0ZXJzLCBlZGl0b3JGZWF0dXJlcykgPT5cbiAgICAgIGZpbHRlcnNcbiAgICAgICAgLmZpbHRlcihmID0+IGYudHlwZSA9PT0gRklMVEVSX1RZUEVTLnBvbHlnb24pXG4gICAgICAgIC5tYXAoZiA9PiBmLnZhbHVlKVxuICAgICAgICAuY29uY2F0KGVkaXRvckZlYXR1cmVzKVxuICApO1xuXG4gIF9vbktleVByZXNzZWQgPSBldmVudCA9PiB7XG4gICAgY29uc3Qge2lzRW5hYmxlZH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKCFpc0VuYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKGV2ZW50LndoaWNoKSB7XG4gICAgICBjYXNlIERFTEVURV9LRVlfRVZFTlRfQ09ERTpcbiAgICAgIGNhc2UgQkFDS1NQQUNFX0tFWV9FVkVOVF9DT0RFOlxuICAgICAgICB0aGlzLl9vbkRlbGV0ZVNlbGVjdGVkRmVhdHVyZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRVNDQVBFX0tFWV9FVkVOVF9DT0RFOlxuICAgICAgICB0aGlzLnByb3BzLm9uU2VsZWN0KG51bGwpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfTtcblxuICBfb25TZWxlY3QgPSAoe3NlbGVjdGVkRmVhdHVyZUlkLCBzb3VyY2VFdmVudH0pID0+IHtcbiAgICBjb25zdCBhbGxGZWF0dXJlcyA9IHRoaXMuYWxsRmVhdHVyZXNTZWxlY3Rvcih0aGlzLnByb3BzKTtcbiAgICB0aGlzLnNldFN0YXRlKFxuICAgICAge1xuICAgICAgICAuLi4oc291cmNlRXZlbnQucmlnaHRCdXR0b25cbiAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgc2hvd0FjdGlvbnM6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3RQb3NpdGlvbjoge1xuICAgICAgICAgICAgICAgIHg6IHNvdXJjZUV2ZW50LmNoYW5nZWRQb2ludGVyc1swXS5vZmZzZXRYLFxuICAgICAgICAgICAgICAgIHk6IHNvdXJjZUV2ZW50LmNoYW5nZWRQb2ludGVyc1swXS5vZmZzZXRZXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA6IG51bGwpXG4gICAgICB9LFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uU2VsZWN0KGFsbEZlYXR1cmVzLmZpbmQoZiA9PiBmLmlkID09PSBzZWxlY3RlZEZlYXR1cmVJZCkpO1xuICAgICAgfVxuICAgICk7XG4gIH07XG5cbiAgX29uRGVsZXRlU2VsZWN0ZWRGZWF0dXJlID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnN0YXRlLnNob3dBY3Rpb25zKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtzaG93QWN0aW9uczogZmFsc2V9KTtcbiAgICB9XG5cbiAgICBjb25zdCB7ZWRpdG9yfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qge3NlbGVjdGVkRmVhdHVyZSA9IHt9fSA9IGVkaXRvcjtcbiAgICB0aGlzLnByb3BzLm9uRGVsZXRlRmVhdHVyZShzZWxlY3RlZEZlYXR1cmUpO1xuICB9O1xuXG4gIF9jbG9zZUZlYXR1cmVBY3Rpb24gPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7c2hvd0FjdGlvbnM6IGZhbHNlfSk7XG4gIH07XG5cbiAgX29uVG9nZ2xlTGF5ZXIgPSBsYXllciA9PiB7XG4gICAgY29uc3Qge3NlbGVjdGVkRmVhdHVyZX0gPSB0aGlzLnByb3BzLmVkaXRvcjtcbiAgICBpZiAoIXNlbGVjdGVkRmVhdHVyZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucHJvcHMub25Ub2dnbGVQb2x5Z29uRmlsdGVyKGxheWVyLCBzZWxlY3RlZEZlYXR1cmUpO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7Y2xhc3NOYW1lLCBjbGlja1JhZGl1cywgZGF0YXNldHMsIGVkaXRvciwgb25VcGRhdGUsIHN0eWxlfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7bGFzdFBvc2l0aW9uLCBzaG93QWN0aW9uc30gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHNlbGVjdGVkRmVhdHVyZUlkID0gZ2V0KGVkaXRvciwgWydzZWxlY3RlZEZlYXR1cmUnLCAnaWQnXSk7XG4gICAgY29uc3QgY3VycmVudEZpbHRlciA9IHRoaXMuY3VycmVudEZpbHRlclNlbGVjdG9yKHRoaXMucHJvcHMpO1xuICAgIGNvbnN0IGF2YWlsYWJsZUxheWVycyA9IHRoaXMuYXZhaWxhYmxlTGF5ZXJzU2VsZXRvcih0aGlzLnByb3BzKTtcbiAgICBjb25zdCBhbGxGZWF0dXJlcyA9IHRoaXMuYWxsRmVhdHVyZXNTZWxlY3Rvcih0aGlzLnByb3BzKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVkV3JhcHBlciBlZGl0b3I9e2VkaXRvcn0gY2xhc3NOYW1lPXtjbGFzc25hbWVzKCdlZGl0b3InLCBjbGFzc05hbWUpfSBzdHlsZT17c3R5bGV9PlxuICAgICAgICA8RHJhd1xuICAgICAgICAgIGNsaWNrUmFkaXVzPXtjbGlja1JhZGl1c31cbiAgICAgICAgICBtb2RlPXtlZGl0b3IubW9kZX1cbiAgICAgICAgICBmZWF0dXJlcz17YWxsRmVhdHVyZXN9XG4gICAgICAgICAgc2VsZWN0ZWRGZWF0dXJlSWQ9e3NlbGVjdGVkRmVhdHVyZUlkfVxuICAgICAgICAgIG9uU2VsZWN0PXt0aGlzLl9vblNlbGVjdH1cbiAgICAgICAgICBvblVwZGF0ZT17b25VcGRhdGV9XG4gICAgICAgICAgZ2V0RWRpdEhhbmRsZVNoYXBlPXtnZXRFZGl0SGFuZGxlU2hhcGV9XG4gICAgICAgICAgZ2V0RmVhdHVyZVN0eWxlPXtnZXRGZWF0dXJlU3R5bGV9XG4gICAgICAgICAgZ2V0RWRpdEhhbmRsZVN0eWxlPXtnZXRFZGl0SGFuZGxlU3R5bGV9XG4gICAgICAgIC8+XG4gICAgICAgIHtzaG93QWN0aW9ucyAmJiBCb29sZWFuKHNlbGVjdGVkRmVhdHVyZUlkKSA/IChcbiAgICAgICAgICA8RmVhdHVyZUFjdGlvblBhbmVsXG4gICAgICAgICAgICBkYXRhc2V0cz17ZGF0YXNldHN9XG4gICAgICAgICAgICBsYXllcnM9e2F2YWlsYWJsZUxheWVyc31cbiAgICAgICAgICAgIGN1cnJlbnRGaWx0ZXI9e2N1cnJlbnRGaWx0ZXJ9XG4gICAgICAgICAgICBvbkNsb3NlPXt0aGlzLl9jbG9zZUZlYXR1cmVBY3Rpb259XG4gICAgICAgICAgICBvbkRlbGV0ZUZlYXR1cmU9e3RoaXMuX29uRGVsZXRlU2VsZWN0ZWRGZWF0dXJlfVxuICAgICAgICAgICAgb25Ub2dnbGVMYXllcj17dGhpcy5fb25Ub2dnbGVMYXllcn1cbiAgICAgICAgICAgIHBvc2l0aW9uPXtsYXN0UG9zaXRpb259XG4gICAgICAgICAgLz5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L1N0eWxlZFdyYXBwZXI+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFZGl0b3I7XG4iXX0=